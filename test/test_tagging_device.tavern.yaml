test_name: adding and tagging a device

stages:
  - name: login
    request:
      url: http://localhost:5000/api/v1/appmgr/tokenservice
      method: POST
      auth:
        - admin
        - admin_123
    response:
      status_code: 200
      headers:
        content-type: application/json
      save:
        body:
          token: token

  - name: adding device
    request:
      url: http://localhost:5000/api/v1/appmgr/devices
      method: POST
      headers:
        x-token-id: "{token:s}"
        content-type: application/json
      json:
        ipAddress: "192.15.1.2"
        port: 4055
        username: "t"
        password: "t"
    response:
      status_code: 201
      headers:
        content-type: application/json
      save:
        body:
          deviceid: deviceId
  
  - name: creating tag
    request:
      url: http://localhost:5000/api/v1/appmgr/tags
      method: POST
      headers:
        x-token-id: "{token:s}"
        content-type: application/json
      json:
        name: "new_testag"
    response:
      status_code: 200
      headers: 
        content-type: application/json
      save:
        body:
          new_testag_id: tagId
  
  - name: tagging device {deviceid:s}
    request:
      url: http://localhost:5000/api/v1/appmgr/tags/{new_testag_id:s}/devices
      method: POST
      headers:
        x-token-id: "{token:s}"
        content-type: application/json
      json:
        devices: 
          - "{deviceid:d}"
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        tagId: "{new_testag_id:s}"
  
  - name: getting device {deviceid:s} by tag
    request:
      url: http://localhost:5000/api/v1/appmgr/devices?searchByTags={new_testag_id:s}
      method: GET
      headers:
        x-token-id: "{token:s}"
        content-type: application/text # used to avoid json error in tavern
    response:
      status_code: 200
      headers:
        content-type: application/json
      body:
        data: 
          - tags:
            - "{new_testag_id:s}" 
      