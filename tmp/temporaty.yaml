- name: getting application specs
    request:
      verify: false
      url: "{host:s}/api/v1/appmgr/localapps"
      method: GET
      headers:
        content-type: application/text
        x-token-id: "{token:s}"
    response:
      status_code: 200
      save:
        $ext:
          function: utils:getFirstAppAndPublish
  
  - name: publishing application
    request:pyt
      verify: false
      url: "{host:s}/api/v1/appmgr/localapps/{appid:s}:1"
      method: PUT
      headers:
        content-type: application/json
        x-token-id: "{token:s}"
      json: "{jsonapp}"
    response:
      status_code: 200

  - name: adding device
    request:
      verify: false
      url: "{host:s}/api/v1/appmgr/devices"
      method: POST
      headers:
        x-token-id: "{token:s}"
        content-type: application/json
      json:
        ipAddress: "10.10.20.51"
        port: 8443
        username: "cisco"
        password: "cisco"
    response:
      status_code: 201
      headers:
        content-type: application/json
      save:
        $ext:
          function: utils:getDeviceId

  - name: upload application
    request:
      verify: false
      url: "{host:s}/api/v1/appmgr/localapps/upload"
      method: POST
      headers:
        x-token-id: "{token:s}"
      files:
        file: "test/NettestApp2V1_lxc.tar.gz"
    response:
      status_code: 201
      headers:
        content-type: application/json;charset=UTF-8
      body:
        $ext:
          function: utils:test_notpublish
      save:
        $ext:
          function: utils:getAppdetails